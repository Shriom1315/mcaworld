[build]
  publish = \".next\"
  command = \"npm run build\"

[build.environment]
  NODE_VERSION = \"18\"
  NPM_VERSION = \"8\"
  NEXT_TELEMETRY_DISABLED = \"1\"

# Handle Next.js routing
[[redirects]]
  from = \"/_next/*\"
  to = \"/_next/:splat\"
  status = 200

[[redirects]]
  from = \"/api/*\"
  to = \"/.netlify/functions/api\"
  status = 200

# Catch-all redirect for client-side routing
[[redirects]]
  from = \"/*\"
  to = \"/index.html\"
  status = 200

[[headers]]
  for = \"/*\"
  [headers.values]
    X-Frame-Options = \"DENY\"
    X-XSS-Protection = \"1; mode=block\"
    X-Content-Type-Options = \"nosniff\"
    Referrer-Policy = \"strict-origin-when-cross-origin\"

[[headers]]
  for = \"/_next/static/*\"
  [headers.values]
    cache-control = \"public,max-age=31536000,immutable\"

# Handle client-side routing
[[redirects]]
  from = \"/api/*\"
  to = \"/.netlify/functions/:splat\"
  status = 200

# Redirect all routes to index.html for SPA behavior
[[redirects]]
  from = \"/*\"
  to = \"/index.html\"
  status = 200
  conditions = {Role = [\"admin\",\"editor\"], Country = [\"US\"], Language = [\"en\"]}